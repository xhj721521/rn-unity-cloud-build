0. 说明

保持现有底部导航：首页 / 探索 / 试炼 / 我的，不要新增「集市」tab。

「命运集市」入口继续在首页（或活动/资产中心）里，点击后进入下面的 MarketHomeScreen。

所有页面统一科技+霓虹风格，和你现在的试炼、活动风格一致。

要实现 3 个主要页面：

MarketHomeScreen：命运集市首页

MarketOrderListScreen：挂单列表页（浏览全部挂单，带筛选）

MarketOrderFormSheet：我要卖 / 我要求购的弹层（简单版，先做 UI 框架）

另外实现一批通用组件和数据类型。

1. 通用数据结构（TypeScript interface）

在 types/market.ts 里定义：

// 交易品类
export type MarketCategory = 'ore' | 'fragment' | 'mapNft';

// 矿石等级
export type OreTier = 'T1' | 'T2' | 'T3' | 'T4' | 'T5';

// 地图类型
export type MapKind = 'personal' | 'team';

// 个人地图枚举
export type PersonalMapId =
  | 'ember_pit'      // 余烬坑
  | 'neon_cave'      // 霓虹洞
  | 'rune_well'      // 符文井
  | 'starlight_grotto' // 星辉窟
  | 'abyss_gate'     // 深渊口
  | 'fate_core';     // 命运核

// 团队地图枚举
export type TeamMapId =
  | 'alliance_front' // 联盟前线
  | 'magma_field'    // 熔火矿场
  | 'storm_mine'     // 风暴矿区
  | 'sanctuary_hall' // 圣所矿厅
  | 'abyss_trench'   // 深渊矿沟
  | 'central_core';  // 中枢矿核

// NFT 类型（复用地图 Id）
export type MapNftTarget =
  | { kind: 'personal'; mapId: PersonalMapId }
  | { kind: 'team'; mapId: TeamMapId };

// 订单方向
export type OrderSide = 'sell' | 'buy'; // 卖单 / 求购单

// 通用玩家信息（头像+昵称）
export interface PlayerInfo {
  id: string;
  nickname: string;
  avatarUrl?: string; // 没有时用首字母占位
}

// 市场资产类型
export type MarketAsset =
  | { category: 'ore'; tier: OreTier } // 矿石
  | {
      category: 'fragment';
      kind: MapKind;
      mapId: PersonalMapId | TeamMapId;
    } // 地图碎片
  | {
      category: 'mapNft';
      kind: MapKind;
      mapId: PersonalMapId | TeamMapId;
    }; // 地图 NFT

// 单条挂单 / 求购
export interface MarketOrder {
  id: string;
  side: OrderSide;      // 'sell' 卖单 | 'buy' 求购
  asset: MarketAsset;   // 交易的东西
  price: number;        // 单价（ARC）
  quantity: number;     // 数量（单位：矿石=单位，碎片=片，NFT=张）
  owner: PlayerInfo;    // 卖家或求购方（头像+昵称）
  change24h?: number;   // 24h 涨跌（可选）
  ordersCount?: number; // “卖盘 X 手” 或 “求购 X 手”（可选）
}

2. 通用 UI 组件
2.1 PlayerBadge（玩家徽章）

用途：所有出现“谁在卖/谁在求购”的地方。

效果：

左：圆形头像占位，默认用首字母+渐变底，如果有 avatarUrl 用图片。

右：两行文字：

上：昵称 nickname

下：小字：卖家 或 求购方（根据 order.side 决定）

Props：

type PlayerBadgeProps = {
  player: PlayerInfo;
  sideLabel: '卖家' | '求购方';
  size?: 'sm' | 'md';
};

2.2 AssetBadge（资产徽章）

用途：展示“卖的是什么东西”。

效果：

左：圆形图标（后面接真实图标，现在用占位色块+首字母）。

右：两行文字：

上：物品名（带类型）

下：小字描述（可交易、可合成、个人地图/团队地图等）

命名逻辑：

矿石：

T1：T1 矿石 · 基础矿

T2：T2 矿石 · 碎片矿

T3：T3 矿石 · 星晶矿

T4：T4 矿石 · 核晶矿

T5：T5 矿石 · 命运矿

地图碎片（个人）示例：个人地图碎片 · 霓虹洞

地图碎片（团队）示例：团队地图碎片 · 联盟前线

地图 NFT：个人地图 NFT · 命运核 / 团队地图 NFT · 中枢矿核

Props：

type AssetBadgeProps = {
  asset: MarketAsset;
  size?: 'sm' | 'md';
};

2.3 MarketOrderCard（订单卡片）

用途：首页热门挂单 + 挂单列表统一用这张卡。

布局：

第一行：左 PlayerBadge，右侧大号价格 120.6 ARC（右对齐）。

第二行：AssetBadge，在价格下面占一行。

第三行（小字信息行）：

左：数量 1200 单位 / 数量 12 片 / 数量 1 张

中：卖盘 82 手 或 求购 44 手（如果有 ordersCount）

右：涨跌 %（绿色 +x.x%，红色 -x.x%，没数据就不显示）

右下角悬浮一个按钮：

卖单：按钮文案 买入

求购：按钮文案 卖给 TA

Props：

type MarketOrderCardProps = {
  order: MarketOrder;
  onPressAction: (order: MarketOrder) => void; // 点击“买入/卖给TA”
  onPressCard?: (order: MarketOrder) => void;  // 点击卡片查看详情（可选）
};

3. 命运集市首页 MarketHomeScreen
3.1 顶部区域

标题：命运集市

副标题：浏览挂单 · 交易矿石 / 地图碎片 / 地图 NFT

右上角：描边按钮：我的订单（先空实现，只需跳到占位页即可）。

3.2 顶部 Tab 与按钮

类别 Tab（第一行）

四个 pill：

全部

矿石

碎片

地图 NFT

选中状态：霓虹渐变描边 + 高亮文字。

排序行（第二行）

左侧三个小按钮（互斥）：

价格（再次点击时在升序/降序中切换，小箭头↑↓）

数量

最新

右侧主按钮：浏览全部挂单

点击：navigate('MarketOrderList', { category: 当前Tab, defaultSort: 当前排序 })

操作行（第三行）

左侧描边按钮：我要卖

右侧实心按钮：我要求购

点击都弹出 MarketOrderFormSheet：

openOrderForm({
  side: 'sell' | 'buy',
  defaultCategory: 当前Tab(全部时默认矿石),
})

3.3 Tab：全部 内容

结构：

顶部 3 张统计卡片（横向滑动即可）：

矿石市场 · 24h 成交额

碎片市场 · 有效挂单数

地图 NFT · 活跃竞拍场次

区块一：矿石 · 热门挂单

标题行：左 矿石 · 热门挂单；右 查看全部 → 跳 MarketOrderList，参数 { category: 'ore' }

下方用 2×2 网格呈现 4 条热门矿石订单：使用 MarketOrderCard。

区块二：碎片 · 热门挂单

同上，参数 { category: 'fragment' }；订单是碎片类型。

区块三：地图 NFT · 热门竞拍

卡片结构使用大卡+小卡两种（你原来 NFT 区域那种）。

这里只要布局即可，点击 立即出价 跳到 NFT 竞拍列表 / 详情。

3.4 Tab：矿石 内容

顶部统计卡片三张：

24h 成交额

挂单总数

活跃买家

二级筛选 chips：

全部

T1 基础矿

T2 碎片矿

T3 星晶矿

T4 核晶矿

T5 命运矿

热门区块 + 卖单/求购切换：

顶部有一个小开关：热门卖单 | 热门求购（二选一）

下方用 2×2 网格渲染 MarketOrderCard：

当选“热门卖单”：side = 'sell'

当选“热门求购”：side = 'buy'

每个卡片点击按钮：打开 MarketOrderFormSheet 的简化确认（如买入数量确认弹窗）。

底部按钮：浏览全部矿石挂单 → MarketOrderList，参数 { category: 'ore' }

3.5 Tab：碎片 内容

顶部统计卡片（类似矿石）：

碎片在售总量 / 平均价格 / 活跃卖家

二级筛选：

第一排：全部 | 个人地图碎片 | 团队地图碎片

选“全部”：第二排不显示地图名字，只按热门展示。

选“个人地图碎片”：第二排 chips：

全部 / 余烬坑 / 霓虹洞 / 符文井 / 星辉窟 / 深渊口 / 命运核

选“团队地图碎片”：第二排 chips：

全部 / 联盟前线 / 熔火矿场 / 风暴矿区 / 圣所矿厅 / 深渊矿沟 / 中枢矿核

热门区块：

同样 热门卖单 | 热门求购 二选一。

卡片用 MarketOrderCard，asset 为 fragment 类型。

底部按钮：浏览全部碎片挂单 → MarketOrderList，参数 { category: 'fragment' }

3.6 Tab：地图 NFT 内容

顶部统计：正在竞拍 X 场 / 总估值 X 等。

焦点大卡：一个正在竞拍的地图 NFT（你原来那张大图的升级版）。

下方 2 列瀑布流卡片：每个 NFT 的当前价 + 倒计时 + 立即出价 / 立即购买。

底部两个按钮：

全部竞拍 → 跳转 NFT 竞拍列表。

发布拍卖 → 打开 NFT 挂单 / 拍卖表单（可以和 MarketOrderFormSheet 共用逻辑）。

4. 挂单列表页 MarketOrderListScreen

这个页面是「浏览全部挂单」的统一实现，支持矿石 / 碎片 / 地图 NFT + 卖单 / 求购 全部筛选。

4.1 路由参数
type MarketOrderListParams = {
  category: MarketCategory | 'all'; // 默认 'all'
  defaultSide?: OrderSide;          // 默认 'sell'
  defaultSort?: 'price' | 'quantity' | 'latest';
};

4.2 页面结构

标题栏

标题：挂单列表

副标题：查看全部命运集市挂单

左侧返回按钮沿用 App 现有样式。

筛选区域

分三行：

第 1 行：类别 Tab

全部 | 矿石 | 碎片 | 地图 NFT

切换时重置对应的子筛选但保留 side（卖/买）。

第 2 行：订单方向 + 排序

左：卖单 | 求购（segment control，互斥）

右：价格 | 数量 | 最新 单选排序，同集市首页逻辑。

第 3 行：二级筛选（根据类别变化）

如果类别 = 矿石：

chips：全部 | T1 基础矿 | T2 碎片矿 | T3 星晶矿 | T4 核晶矿 | T5 命运矿

如果类别 = 碎片：

第一排 chips：全部 | 个人地图碎片 | 团队地图碎片

第二排根据第一排显示：

个人地图：全部 / 余烬坑 / 霓虹洞 / 符文井 / 星辉窟 / 深渊口 / 命运核

团队地图：全部 / 联盟前线 / 熔火矿场 / 风暴矿区 / 圣所矿厅 / 深渊矿沟 / 中枢矿核

如果类别 = 地图 NFT：

第一排 chips：全部 | 个人 NFT | 团队 NFT

第二排同上，用地图名字 chips。

如果类别 = 全部：

只显示一个简单 chips：全部 | 矿石 | 碎片 | 地图 NFT（作为快速过滤）。

4.3 列表展示

使用 FlatList 垂直滚动。

每个 item 用 MarketOrderCard：

左边 PlayerBadge，显示圆头像+昵称。

中部 AssetBadge 显示物品信息。

右侧价格大字。

底部显示数量、卖盘/求购手数、涨跌。

按当前筛选条件排序（价格/数量/最新）。

4.4 交互行为

点击卡片整体：打开挂单详情页（可以先用简单的 Alert 或占位页）。

点击卡片按钮：

如果当前 side = 'sell'（卖单列表）：

按钮文案 买入 → 打开下单确认弹窗（输入购买数量）。

如果当前 side = 'buy'（求购列表）：

按钮文案 卖给 TA → 打开卖出确认弹窗（输入卖出数量）。

顶部筛选变化时自动刷新列表。

下拉刷新 / 滚动到底部加载更多可选做。

4.5 「我要卖 / 我要求购」入口

在列表页的右下角悬浮一个圆按钮：

默认展示 + 图标。

点击弹出一个小菜单：我要卖 / 我要求购。

选择后打开 MarketOrderFormSheet，并带入当前类别和子筛选（例如当前是“个人地图碎片-霓虹洞”，表单默认选中这个品类）。

5. 我要卖 / 我要求购表单 MarketOrderFormSheet

这里只要一个统一的底部弹层，不用做所有逻辑，先把结构搭好。

5.1 打开参数
type MarketOrderFormProps = {
  side: OrderSide;            // 'sell' or 'buy'
  defaultCategory: MarketCategory;
  defaultAsset?: MarketAsset; // 从列表/首页带入时有
};

5.2 表单内容

顶部：标题

发布卖单 或 发布求购（根据 side）。

下拉选择品类（三级联动）：

第一列：矿石 / 碎片 / 地图 NFT

第二列（根据第一列）：

矿石：T1 基础矿 / T2 碎片矿 / T3 星晶矿 / T4 核晶矿 / T5 命运矿

碎片：个人地图碎片 / 团队地图碎片

地图 NFT：个人 NFT / 团队 NFT

第三列（根据第二列）：

个人地图：余烬坑 / 霓虹洞 / 符文井 / 星辉窟 / 深渊口 / 命运核

团队地图：联盟前线 / 熔火矿场 / 风暴矿区 / 圣所矿厅 / 深渊矿沟 / 中枢矿核

输入框：

数量（数字）

单价（ARC）

底部按钮：确认发布（先只做关闭+Toast 占位）。

6. 验收标准（前端）

给 Copilot 的硬性检查点，避免实现跑偏：

6.1 功能行为

类别联动正确

在集市首页任意 Tab 点击「浏览全部挂单」，能正确跳到 MarketOrderListScreen，并自动选中对应类别。

挂单列表顶部类别切换，子筛选栏实时变化，不出现错位的菜单。

卖单 / 求购切换

列表页 卖单 / 求购 切换时，卡片右下角按钮文案必须随之变成 买入 / 卖给 TA。

PlayerBadge 下方文案分别是 卖家 / 求购方。

筛选逻辑完整

矿石 Tab 下：能按 全部/T1/T2/T3/T4/T5 正确过滤。

碎片 Tab 下：

能切到 个人地图碎片 / 团队地图碎片；

对应地图 chips（余烬坑/霓虹洞…；联盟前线/熔火矿场…）可以正确过滤。

NFT Tab 下：同样按个人/团队+地图名称过滤。

排序正常

价格排序：点击一次升序、第二次降序，箭头方向与列表结果一致。

数量/最新排序：至少支持倒序（多到少 / 新到旧）。

我要卖 / 我要求购 表单预填

在列表页、集市首页点击 我要卖/我要求购 时，弹出的表单 默认选中当前类别；

如果用户是在某条订单卡片上点击，表单要预填该资产（默认品类与地图/矿石等级）。

6.2 UI / 视觉

统一头像 + 物品圆框

所有有玩家的地方都使用 PlayerBadge，头像为圆形。

所有物品名左边有圆形图标（占位），风格一致。

卡片风格一致

MarketOrderCard 在首页和列表页看起来是同一套组件（圆角、阴影、发光边）。

文案布局：左头像+昵称，中部物品信息，右侧价格，底部小字信息 + 按钮，不要东倒西歪。

文本不溢出

昵称过长要截断加 ...。

地图名和类型在小屏上不能挤到一起，要预留最小宽度。

底部导航不遮挡

列表页和集市首页的最后一条卡片不会被底部导航遮挡，留出足够 padding。

6.3 代码结构

通用组件（PlayerBadge / AssetBadge / MarketOrderCard / PillTab 等）放在 components/market/，不要重复写在每个页面。

所有枚举（矿石、地图名）用 TypeScript 类型+常量统一管理，不要在 JSX 里写死多份中文字符串。

列表使用 FlatList，支持下拉刷新，后续对接接口时只需替换数据源。